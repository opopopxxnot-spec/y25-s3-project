<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-VOTE INDIA | RVM 2.0 (Final)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        tech: ['Rajdhani', 'sans-serif'],
                    },
                    colors: {
                        indiaOrange: '#FF9933',
                        indiaGreen: '#138808',
                        indiaBlue: '#000080',
                        darkBg: '#0f172a',
                    },
                    animation: {
                        'scan': 'scan 2s linear infinite',
                        'flash-red': 'flashRed 1s infinite',
                    },
                    keyframes: {
                        scan: {
                            '0%': { top: '0%' },
                            '100%': { top: '100%' },
                        },
                        flashRed: {
                            '0%, 100%': { backgroundColor: 'rgba(239, 68, 68, 0)' },
                            '50%': { backgroundColor: 'rgba(239, 68, 68, 0.3)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #0f172a;
            background-image: 
                radial-gradient(at 0% 0%, rgba(255, 153, 51, 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(19, 136, 8, 0.15) 0px, transparent 50%);
            color: #e2e8f0;
            overflow-x: hidden;
        }

        /* Glassmorphism */
        .glass-panel {
            background: rgba(30, 41, 59, 0.85);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .nav-btn.active {
            background: linear-gradient(90deg, #FF9933 0%, #ff8c00 100%);
            color: white;
            box-shadow: 0 0 15px rgba(255, 153, 51, 0.4);
        }

        /* EVM Button Styles */
        .evm-btn {
            background: #2563eb;
            box-shadow: inset 0 2px 4px rgba(255,255,255,0.3), 0 4px 6px rgba(0,0,0,0.4);
            transition: all 0.1s;
        }
        .evm-btn:active {
            transform: scale(0.95);
            background: #1d4ed8;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.6);
        }
        .evm-led {
            background: #333;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.8);
        }
        .evm-led.on {
            background: #ef4444;
            box-shadow: 0 0 10px #ef4444;
        }

        /* Views */
        .section-view {
            display: none;
            animation: fadeIn 0.5s ease-out forwards;
        }
        .section-view.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Scrollbar for Modal */
        .custom-scroll::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.2);
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 4px;
        }
        .custom-scroll::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
    </style>
</head>
<body class="font-sans antialiased min-h-screen flex flex-col">

    <!-- Navigation Bar -->
    <nav class="fixed top-0 w-full z-50 glass-panel border-b border-gray-700">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-indiaOrange via-white to-indiaGreen rounded-full flex items-center justify-center shadow-lg">
                        <i class="fas fa-vote-yea text-indiaBlue text-lg"></i>
                    </div>
                    <div class="flex flex-col">
                        <span class="font-tech font-bold text-2xl tracking-wider text-white">E-VOTE <span class="text-indiaOrange">INDIA</span></span>
                        <span class="text-[10px] text-gray-400 uppercase tracking-[0.2em]">Election Commission of India</span>
                    </div>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <button onclick="router('home')" id="nav-home" class="nav-btn active px-4 py-2 rounded-md text-sm font-medium transition-all">Home</button>
                        <button onclick="router('about')" id="nav-about" class="nav-btn text-gray-300 hover:text-white hover:bg-white/10 px-4 py-2 rounded-md text-sm font-medium transition-all">Protocol</button>
                        <button onclick="router('register')" id="nav-register" class="nav-btn text-gray-300 hover:text-white hover:bg-white/10 px-4 py-2 rounded-md text-sm font-medium transition-all border border-indiaOrange/50">Register / Vote</button>
                    </div>
                </div>
                <div class="-mr-2 flex md:hidden">
                    <button onclick="toggleMobileMenu()" class="bg-gray-800 inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700 focus:outline-none">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden glass-panel">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <button onclick="router('home')" class="text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium w-full text-left">Home</button>
                <button onclick="router('register')" class="text-indiaOrange block px-3 py-2 rounded-md text-base font-medium w-full text-left">Register to Vote</button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow pt-24 pb-12 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto w-full">

        <!-- HOME -->
        <section id="home" class="section-view active">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center min-h-[80vh]">
                <div class="space-y-8">
                    <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-blue-900/30 border border-blue-500/30 text-blue-400 text-xs font-bold tracking-widest uppercase">
                        <span class="w-2 h-2 rounded-full bg-blue-500 animate-pulse"></span>
                        Secure Blockchain Protocol
                    </div>
                    <h1 class="text-5xl md:text-7xl font-tech font-bold leading-tight">
                        Democracy <br>
                        <span class="text-transparent bg-clip-text bg-gradient-to-r from-indiaOrange via-white to-indiaGreen">Digitized.</span>
                    </h1>
                    <p class="text-lg text-gray-400 max-w-xl">
                        RVM 2.0: The world's most advanced voting architecture. Now features mandatory <strong>Cognitive Verification</strong> protocols to ensure informed voting.
                    </p>
                    <div class="flex flex-col sm:flex-row gap-4">
                        <button onclick="router('register')" class="px-8 py-4 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 text-white rounded-xl font-bold shadow-lg shadow-blue-900/50 transition-all transform hover:-translate-y-1 flex items-center justify-center gap-3">
                            <i class="fas fa-fingerprint"></i> Cast Your Vote
                        </button>
                        <button onclick="router('about')" class="px-8 py-4 glass-panel hover:bg-white/5 text-white rounded-xl font-bold border border-white/10 transition-all flex items-center justify-center gap-3">
                            <i class="fas fa-shield-alt"></i> How it Works
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- REGISTER / LOGIN -->
        <section id="register" class="section-view">
            <div class="max-w-md mx-auto">
                <div class="glass-panel rounded-2xl p-8 shadow-2xl relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-indiaOrange via-white to-indiaGreen"></div>
                    <h2 class="text-3xl font-tech font-bold mb-2 text-center">Voter Identity</h2>
                    <p class="text-center text-gray-400 text-sm mb-8">Authenticate with Aadhaar Database</p>

                    <form id="loginForm" onsubmit="handleRegistration(event)" class="space-y-6">
                        <div>
                            <label class="block text-xs font-medium text-gray-400 mb-1 uppercase">Full Name (As per Aadhaar)</label>
                            <input type="text" id="voterName" required class="w-full bg-gray-900/50 border border-gray-700 text-white rounded-lg py-2.5 px-4 focus:border-indiaBlue focus:ring-1 focus:ring-indiaBlue" placeholder="Amit Sharma">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-400 mb-1 uppercase">Aadhaar Number</label>
                            <input type="text" id="aadhaarNum" required maxlength="12" pattern="\d*" class="w-full bg-gray-900/50 border border-gray-700 text-white rounded-lg py-2.5 px-4 focus:border-indiaBlue focus:ring-1 focus:ring-indiaBlue" placeholder="XXXX XXXX XXXX">
                        </div>
                        <button type="submit" class="w-full py-3 bg-indiaBlue hover:bg-blue-700 text-white rounded-lg font-bold shadow-lg transition-all flex justify-center items-center gap-2">
                            Proceed to Biometric Check <i class="fas fa-arrow-right"></i>
                        </button>
                    </form>
                </div>
            </div>
        </section>

        <!-- HARDWARE CHECK MODAL -->
        <div id="hardwareModal" class="fixed inset-0 z-[60] flex items-center justify-center bg-black/80 backdrop-blur-sm hidden">
            <div class="glass-panel max-w-sm w-full p-6 rounded-2xl border border-indiaOrange/30 shadow-2xl">
                <div class="text-center">
                    <div class="w-16 h-16 bg-indiaOrange/20 rounded-full flex items-center justify-center mx-auto mb-4 text-indiaOrange">
                        <i class="fas fa-laptop text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2">Device Check</h3>
                    <p class="text-gray-300 text-sm mb-6">Laptop detected. To ensure secure voting, we need to verify hardware capabilities.</p>
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="handleLaptopHardwareResponse(false)" class="px-4 py-2 rounded-lg border border-gray-600 text-gray-300 hover:bg-gray-700 text-sm">No / Not Sure</button>
                        <button onclick="handleLaptopHardwareResponse(true)" class="px-4 py-2 rounded-lg bg-indiaOrange text-black font-bold hover:bg-orange-500 text-sm">Yes, I have one</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- BIOMETRIC SCANNER -->
        <section id="biometric" class="section-view">
            <div class="max-w-md mx-auto text-center">
                <div class="glass-panel rounded-2xl p-10 shadow-2xl border border-green-500/20">
                    <h2 class="text-2xl font-tech font-bold mb-6 text-white">Biometric Verification</h2>
                    <div class="relative w-48 h-48 mx-auto mb-8 cursor-pointer group" onclick="startScan()">
                        <div class="absolute inset-0 flex items-center justify-center text-gray-600 group-hover:text-green-500/50 transition-colors duration-500">
                            <i class="fas fa-fingerprint text-[8rem]"></i>
                        </div>
                        <div id="scanOverlay" class="absolute inset-0 overflow-hidden rounded-xl hidden">
                            <div class="scanner-line animate-scan" style="position:absolute; width:100%; height:4px; background:#10b981; box-shadow:0 0 10px #10b981; top:0; left:0; animation:scan 2s linear infinite;"></div>
                            <div class="absolute inset-0 bg-green-500/10"></div>
                        </div>
                        <div id="tapHint" class="absolute inset-0 flex items-center justify-center">
                            <span class="px-4 py-2 bg-black/60 rounded-full text-xs font-bold text-white backdrop-blur-md animate-pulse">TAP TO SCAN</span>
                        </div>
                    </div>
                    <div id="scanStatus" class="text-sm font-mono text-gray-400 h-6">Waiting for input...</div>
                    <div id="deviceInfo" class="mt-8 pt-4 border-t border-gray-700 text-xs text-gray-500 flex justify-between items-center">
                        <span><i class="fas fa-shield-alt mr-1"></i>Secure Connection</span>
                        <span id="detectedType" class="text-indiaOrange">Detecting...</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- VOTING BOOTH -->
        <section id="voting-booth" class="section-view">
            <div class="max-w-4xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- Control Unit -->
                <div class="md:col-span-2 space-y-4">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-2xl font-tech font-bold">Electronic Ballot Unit</h2>
                        <div class="flex items-center gap-2">
                            <span class="w-3 h-3 rounded-full bg-green-500 animate-pulse"></span>
                            <span class="text-xs text-green-400 font-mono">READY</span>
                        </div>
                    </div>
                    <div class="bg-gray-200 rounded-xl p-1 shadow-inner border-4 border-gray-700">
                        <div class="bg-white rounded-lg overflow-hidden">
                            <div class="bg-gray-800 text-white p-3 flex justify-between text-xs font-bold uppercase tracking-wider">
                                <span>Candidate / Symbol</span>
                                <span>Select</span>
                            </div>
                            <div id="candidate-list"></div>
                        </div>
                    </div>
                </div>
                <!-- VVPAT -->
                <div class="md:col-span-1">
                    <div class="bg-gray-800 rounded-xl p-4 border-2 border-gray-600 h-full flex flex-col relative shadow-2xl">
                        <h3 class="text-center text-gray-400 font-bold text-sm mb-4 border-b border-gray-600 pb-2">VVPAT DISPLAY</h3>
                        <div class="bg-black rounded-lg h-48 w-3/4 mx-auto relative overflow-hidden border-4 border-gray-600 shadow-inner">
                            <div id="vvpat-light" class="absolute inset-0 bg-yellow-100/10 opacity-0 transition-opacity duration-300 pointer-events-none z-10"></div>
                            <div id="vvpat-slip" class="bg-white w-3/4 h-24 mx-auto mt-4 p-2 text-center shadow-lg transform -translate-y-[150%] transition-transform duration-700 flex flex-col items-center justify-center">
                                <div id="slip-symbol" class="text-2xl text-black mb-1"></div>
                                <div id="slip-name" class="text-[10px] font-bold text-black uppercase leading-tight"></div>
                                <div class="text-[8px] text-gray-500 mt-1">ECI VERIFIED</div>
                            </div>
                        </div>
                        <div class="mt-auto text-center">
                            <div class="text-[10px] text-gray-500">Voter Verifiable Paper Audit Trail</div>
                            <div class="w-full h-1 bg-gray-700 mt-2 rounded-full overflow-hidden">
                                <div id="printer-progress" class="h-full bg-green-500 w-0"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- MANDATORY RESEARCH MODAL (FIXED LAYOUT) -->
        <div id="researchModal" class="fixed inset-0 z-[70] flex items-center justify-center bg-black/90 backdrop-blur-md hidden p-4 sm:p-6">
            <!-- Modal Container: Fixed Height & Flex Column -->
            <div class="glass-panel w-full max-w-2xl h-[85vh] rounded-2xl border border-indiaBlue/50 shadow-2xl flex flex-col overflow-hidden relative">
                
                <!-- 1. HEADER (Fixed) -->
                <div class="p-6 border-b border-gray-700 flex justify-between items-center bg-gray-900/80 shrink-0">
                    <div>
                        <h3 class="text-xl font-tech font-bold text-white uppercase tracking-wider"><i class="fas fa-eye text-indiaOrange mr-2"></i>Mandatory Intelligence</h3>
                        <p class="text-xs text-gray-400">Review Candidate Dossier</p>
                    </div>
                    <div class="flex flex-col items-end">
                        <div id="countdown-timer" class="text-2xl font-mono text-indiaOrange font-bold">5</div>
                        <div class="text-[10px] text-gray-500">SEC REMAINING</div>
                    </div>
                </div>
                
                <!-- 2. SCROLLABLE BODY (Flex Grow) -->
                <!-- Added 'custom-scroll' for visual flair, and onscroll event for logic -->
                <div id="research-body" class="p-6 overflow-y-auto flex-grow space-y-6 custom-scroll bg-black/20" onscroll="checkScroll()">
                    <div class="flex items-center gap-4">
                        <div id="res-symbol" class="w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center text-3xl shrink-0"></div>
                        <div>
                            <h2 id="res-name" class="text-2xl font-bold text-white"></h2>
                            <span id="res-alias" class="text-sm text-gray-400 font-mono border border-gray-600 px-2 py-0.5 rounded"></span>
                        </div>
                    </div>

                    <div class="aspect-video bg-black rounded-xl border border-gray-700 flex items-center justify-center relative overflow-hidden group shrink-0">
                        <iframe id="res-video" class="w-full h-full opacity-70 group-hover:opacity-100 transition-opacity" src="" frameborder="0" allowfullscreen></iframe>
                        <div class="absolute inset-0 pointer-events-none flex items-center justify-center">
                            <i class="fab fa-youtube text-red-600 text-6xl opacity-80"></i>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-green-900/20 border border-green-500/30 rounded-xl p-4">
                            <h4 class="text-green-400 font-bold mb-3 uppercase text-xs tracking-widest"><i class="fas fa-chart-line mr-2"></i>Achievements</h4>
                            <ul id="res-pros" class="list-disc list-inside text-sm text-gray-300 space-y-2"></ul>
                        </div>
                        <div class="bg-red-900/20 border border-red-500/30 rounded-xl p-4">
                            <h4 class="text-red-400 font-bold mb-3 uppercase text-xs tracking-widest"><i class="fas fa-exclamation-triangle mr-2"></i>Criticisms</h4>
                            <ul id="res-cons" class="list-disc list-inside text-sm text-gray-300 space-y-2"></ul>
                        </div>
                    </div>
                    
                    <!-- Bottom Padding to ensure user scrolls enough -->
                    <div class="h-8"></div>
                    <div class="text-center text-xs text-gray-500 italic pb-2">End of Report</div>
                </div>

                <!-- 3. FOOTER (Fixed) -->
                <div class="p-4 border-t border-gray-700 bg-gray-900 shrink-0 flex flex-col sm:flex-row justify-between items-center gap-4 z-10">
                    <!-- Highly Visible Skip Button -->
                    <button onclick="attemptSkip()" class="w-full sm:w-auto px-6 py-3 bg-red-600 rounded text-white hover:bg-red-700 font-bold text-xs uppercase tracking-widest transition-all shadow-lg shadow-red-900/40">
                        Skip Review
                    </button>
                    
                    <button id="confirm-vote-btn" onclick="confirmAndVote()" disabled class="w-full sm:flex-grow py-3 bg-gray-800 text-gray-500 rounded-lg font-bold shadow-lg flex justify-center items-center gap-2 cursor-not-allowed transition-all border border-gray-700">
                        <span id="btn-text">Read More & Scroll Down...</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- SUSPICION ALERT MODAL -->
        <div id="suspicionModal" class="fixed inset-0 z-[80] flex items-center justify-center bg-red-900/40 backdrop-blur-lg hidden security-alert-bg">
            <div class="bg-black border-2 border-red-600 p-8 rounded-lg max-w-md text-center shadow-[0_0_50px_rgba(220,38,38,0.5)] m-4 relative">
                <i class="fas fa-exclamation-triangle text-6xl text-red-500 mb-4 animate-pulse"></i>
                <h2 class="text-3xl font-bold text-white mb-2 tracking-widest uppercase">Security Alert</h2>
                <p class="text-red-400 font-mono text-sm mb-6">
                    VIOLATION DETECTED: You attempted to skip mandatory candidate research.<br><br>
                    <span class="text-white font-bold">"You have not researched the party. We have a suspicion on you."</span>
                </p>
                <button onclick="closeSuspicion()" class="w-full py-3 bg-red-600 hover:bg-red-700 text-white font-bold rounded uppercase tracking-widest shadow-lg shadow-red-900/50">
                    Return & Review Data
                </button>
            </div>
        </div>

        <!-- SUCCESS -->
        <section id="success" class="section-view text-center">
            <div class="max-w-lg mx-auto mt-10">
                <div class="w-24 h-24 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg shadow-green-500/50 animate-bounce">
                    <i class="fas fa-check text-4xl text-white"></i>
                </div>
                <h2 class="text-4xl font-tech font-bold text-white mb-2">Vote Cast Successfully</h2>
                <p class="text-gray-400 mb-8">Your vote has been cryptographically hashed and added to the blockchain.</p>
                <div class="glass-panel p-6 rounded-xl text-left font-mono text-xs space-y-3 border border-green-500/30">
                    <div class="flex justify-between border-b border-gray-700 pb-2">
                        <span class="text-gray-500">TIMESTAMP</span>
                        <span class="text-white" id="receipt-time"></span>
                    </div>
                    <div class="flex justify-between border-b border-gray-700 pb-2">
                        <span class="text-gray-500">TRANSACTION ID</span>
                        <span class="text-indiaOrange">TXN_88291_BLK</span>
                    </div>
                    <div>
                        <span class="text-gray-500 block mb-1">BLOCK HASH</span>
                        <span class="text-blue-400 break-all" id="receipt-hash"></span>
                    </div>
                </div>
                <button onclick="location.reload()" class="mt-8 px-6 py-3 bg-gray-800 hover:bg-gray-700 rounded-lg text-white font-bold transition-colors">Return to Home</button>
            </div>
        </section>
        
        <!-- ABOUT -->
        <section id="about" class="section-view">
             <div class="max-w-3xl mx-auto glass-panel p-8 rounded-2xl">
                 <h2 class="text-3xl font-tech font-bold mb-6 text-indiaOrange">About RVM 2.0</h2>
                 <p class="text-gray-300 leading-relaxed">The Remote Voting Machine (RVM) 2.0 project aims to solve the problem of domestic migration. Now includes mandatory voter education protocols.</p>
             </div>
        </section>

    </main>

    <footer class="border-t border-gray-800 bg-black/40 py-6 mt-auto">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-gray-600 text-sm">© 2025 Prototype for Educational Purposes.</p>
        </div>
    </footer>

    <script>
        // --- DATA ---
        let currentCandId = null;
        const candidates = [
            { 
                id: 1, name: "National Progress Party", symbol: "fa-sun", color: "text-orange-500", alias: "NPP",
                video: "https://www.youtube.com/embed/LXb3EKWsInQ", 
                pros: ["Constructed 5000km of new highways", "GDP growth rate at 7.2%", "Launched Digital India initiative"],
                cons: ["Unemployment rate increased by 1.5%", "Rising inflation in fuel prices", "Criticism over media censorship"]
            },
            { 
                id: 2, name: "United Tech Alliance", symbol: "fa-laptop-code", color: "text-blue-500", alias: "UTA",
                video: "https://www.youtube.com/embed/M7lc1UVf-VE",
                pros: ["100% rural internet connectivity", "Subsidies for tech startups", "Modernized education curriculum"],
                cons: ["Data privacy concerns pending", "Neglect of traditional agriculture sector", "Digital divide in remote areas"]
            },
            { 
                id: 3, name: "Green Earth Front", symbol: "fa-leaf", color: "text-green-500", alias: "GEF",
                video: "https://www.youtube.com/embed/2N0lK4C9yTk",
                pros: ["Reduced carbon emissions by 20%", "Massive reforestation projects", "Clean river initiatives"],
                cons: ["Industrial growth slowed down", "Higher taxes on non-electric vehicles", "Energy transition costs passed to consumers"]
            },
            { 
                id: 4, name: "NOTA (None of the Above)", symbol: "fa-ban", color: "text-gray-500", alias: "NOTA",
                video: "https://www.youtube.com/embed/XP2d72F8e5I",
                pros: ["Registers your dissent democratically", "Reduces potential for bogus voting", "Sends a message to political parties"],
                cons: ["Does not affect election outcome directly", "Often considered a 'wasted' vote", "No candidate is elected from NOTA"]
            }
        ];

        // --- ROUTER & INIT ---
        function router(sectionId) {
            document.querySelectorAll('.section-view').forEach(el => el.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active', 'text-white'));
            const navBtn = document.getElementById(`nav-${sectionId}`);
            if(navBtn) navBtn.classList.add('active');
            document.getElementById('mobile-menu').classList.add('hidden');
        }
        function toggleMobileMenu() { document.getElementById('mobile-menu').classList.toggle('hidden'); }
        window.onload = () => router('home');

        // --- REGISTRATION ---
        function handleRegistration(e) {
            e.preventDefault();
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth < 768;
            if (isMobile) {
                document.getElementById('detectedType').innerHTML = '<i class="fas fa-mobile-alt mr-1"></i> Mobile Device';
                router('biometric');
            } else {
                document.getElementById('detectedType').innerHTML = '<i class="fas fa-laptop mr-1"></i> Laptop/PC';
                document.getElementById('hardwareModal').classList.remove('hidden');
            }
        }
        function handleLaptopHardwareResponse(hasScanner) {
            document.getElementById('hardwareModal').classList.add('hidden');
            router('biometric');
            if(!hasScanner) document.getElementById('scanStatus').innerText = "No scanner? Using Cam-Scan...";
        }

        // --- BIOMETRIC ---
        let scanning = false;
        function startScan() {
            if(scanning) return;
            scanning = true;
            document.getElementById('tapHint').style.display = 'none';
            document.getElementById('scanOverlay').classList.remove('hidden');
            document.getElementById('scanStatus').innerText = "Scanning...";
            setTimeout(() => {
                document.getElementById('scanStatus').innerText = "Verifying UIDAI...";
                setTimeout(() => {
                    initVotingBooth();
                    router('voting-booth');
                }, 1500);
            }, 1500);
        }

        // --- VOTING BOOTH ---
        function initVotingBooth() {
            const list = document.getElementById('candidate-list');
            list.innerHTML = '';
            candidates.forEach((cand, index) => {
                const row = document.createElement('div');
                row.className = "flex items-center justify-between p-4 border-b border-gray-200 hover:bg-gray-50 transition-colors";
                row.innerHTML = `
                    <div class="flex items-center gap-4">
                        <span class="font-bold text-gray-400 text-lg w-6">${index + 1}</span>
                        <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center border border-gray-300">
                            <i class="fas ${cand.symbol} ${cand.color} text-xl"></i>
                        </div>
                        <div>
                            <div class="font-bold text-gray-800 uppercase text-sm md:text-base">${cand.name}</div>
                            <div class="text-[10px] text-gray-500 font-bold">${cand.alias}</div>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <div id="led-${cand.id}" class="evm-led w-4 h-4 rounded-full"></div>
                        <button onclick="openResearch(${cand.id})" class="evm-btn w-16 h-10 rounded-lg flex items-center justify-center text-white font-bold text-xs uppercase tracking-wider">
                            Vote
                        </button>
                    </div>
                `;
                list.appendChild(row);
            });
        }

        // --- RESEARCH PROTOCOL (VERIFICATION LOGIC) ---
        let researchTimer = null;
        let countdownVal = 5;
        let hasScrolledToBottom = false;
        let hasTimeElapsed = false;

        function openResearch(id) {
            if(document.querySelector('.evm-led.on')) return; 
            currentCandId = id;
            const cand = candidates.find(c => c.id === id);

            // 1. Reset State
            hasScrolledToBottom = false;
            hasTimeElapsed = false;
            countdownVal = 5;
            
            // 2. Populate Modal
            document.getElementById('res-name').innerText = cand.name;
            document.getElementById('res-alias').innerText = cand.alias;
            document.getElementById('res-symbol').innerHTML = `<i class="fas ${cand.symbol} ${cand.color}"></i>`;
            document.getElementById('res-video').src = cand.video;
            document.getElementById('res-pros').innerHTML = cand.pros.map(p => `<li>${p}</li>`).join('');
            document.getElementById('res-cons').innerHTML = cand.cons.map(c => `<li>${c}</li>`).join('');

            // 3. Reset Buttons
            const btn = document.getElementById('confirm-vote-btn');
            updateButtonState(btn);
            
            // 4. Show Modal
            document.getElementById('researchModal').classList.remove('hidden');
            
            // 5. Start Timer
            const timerDisplay = document.getElementById('countdown-timer');
            timerDisplay.innerText = countdownVal;
            
            if(researchTimer) clearInterval(researchTimer);
            researchTimer = setInterval(() => {
                countdownVal--;
                timerDisplay.innerText = countdownVal;
                
                if(countdownVal <= 0) {
                    clearInterval(researchTimer);
                    hasTimeElapsed = true;
                    timerDisplay.innerText = "✓";
                    updateButtonState(btn);
                }
                updateButtonState(btn); // Update text while counting down
            }, 1000);
        }

        // SCROLL CHECK LOGIC
        function checkScroll() {
            const body = document.getElementById('research-body');
            const btn = document.getElementById('confirm-vote-btn');
            
            // Logic: Is user near bottom? (within 20px)
            if (body.scrollTop + body.clientHeight >= body.scrollHeight - 50) {
                hasScrolledToBottom = true;
                updateButtonState(btn);
            }
        }

        function updateButtonState(btn) {
            const text = document.getElementById('btn-text');
            
            if (!hasTimeElapsed) {
                btn.disabled = true;
                btn.className = "w-full sm:flex-grow py-3 bg-gray-800 text-gray-500 rounded-lg font-bold shadow-lg flex justify-center items-center gap-2 cursor-not-allowed transition-all border border-gray-700";
                text.innerText = `Analyzing Engagement (${countdownVal}s)...`;
            } 
            else if (!hasScrolledToBottom) {
                btn.disabled = true;
                btn.className = "w-full sm:flex-grow py-3 bg-blue-900/30 text-blue-200 rounded-lg font-bold shadow-lg flex justify-center items-center gap-2 cursor-not-allowed transition-all border border-blue-500/30";
                text.innerText = "Please Scroll to Read Full Report ↓";
            } 
            else {
                // Both true
                btn.disabled = false;
                btn.className = "w-full sm:flex-grow py-3 bg-indiaGreen hover:bg-green-600 text-white rounded-lg font-bold shadow-lg flex justify-center items-center gap-2 transition-all cursor-pointer";
                text.innerText = "I have researched. Confirm Vote.";
            }
        }

        function attemptSkip() {
            document.getElementById('suspicionModal').classList.remove('hidden');
        }

        function closeSuspicion() {
            document.getElementById('suspicionModal').classList.add('hidden');
        }

        function confirmAndVote() {
            document.getElementById('researchModal').classList.add('hidden');
            castVote(currentCandId);
        }

        // --- CAST VOTE (EXISTING) ---
        function castVote(candId) {
            const cand = candidates.find(c => c.id === candId);
            document.getElementById(`led-${candId}`).classList.add('on');
            printVVPAT(cand);
        }

        function printVVPAT(cand) {
            const slip = document.getElementById('vvpat-slip');
            const light = document.getElementById('vvpat-light');
            document.getElementById('slip-symbol').innerHTML = `<i class="fas ${cand.symbol} ${cand.color}"></i>`;
            document.getElementById('slip-name').innerText = cand.name;

            light.style.opacity = '1';
            setTimeout(() => slip.style.transform = 'translateY(0)', 200);
            
            document.getElementById('printer-progress').style.transition = "width 2s linear";
            document.getElementById('printer-progress').style.width = "100%";

            setTimeout(() => {
                slip.style.transform = 'translateY(150%)';
                light.style.opacity = '0';
                setTimeout(() => {
                    generateReceipt();
                    router('success');
                }, 1000);
            }, 3000);
        }

        function generateReceipt() {
            document.getElementById('receipt-time').innerText = new Date().toISOString();
            let hash = '0x';
            for(let i=0; i<64; i++) hash += '0123456789abcdef'[Math.floor(Math.random()*16)];
            document.getElementById('receipt-hash').innerText = hash;
        }
    </script>
</body>
</html>